# 2025-11-19 Action 2 — 画面⇔API対応表

screen_usecase.md を基に、React/Express担当が優先実装するAPIと各画面ユースケースのマッピングを整理したもの。MVP重点（ログイン・プロジェクト・シーン保存）を★で示す。

## サマリー
| 画面 / ユースケース | 主要操作 | API（HTTP, Path） | 備考 |
| --- | --- | --- | --- |
| ログイン ★ | 認証フォーム送信 | `POST /api/auth/login` | JWT発行、失敗時401。 |
| ログイン ★ | トークン再取得 | `POST /api/auth/refresh` | Refresh TokenをHttpOnly Cookieで扱う案。 |
| 新規登録 | アカウント作成 | `POST /api/auth/register` | 成功後ログイン画面or自動ログイン。 |
| プロジェクト一覧 ★ | プロジェクト取得 | `GET /api/projects?search=&status=` | フィルタリング・ページング。 |
| プロジェクト一覧 | プロジェクト作成 | `POST /api/projects` | 作成後一覧を再取得。 |
| プロジェクト詳細（概要） ★ | プロジェクト詳細取得 | `GET /api/projects/:id` | Unity埋め込み設定や最新シーン情報を含める。 |
| プロジェクト詳細 | プロジェクト更新 | `PUT /api/projects/:id` | 説明・メンバー変更。 |
| プロジェクト詳細 | プロジェクト削除 | `DELETE /api/projects/:id` | アーカイブ扱いも検討。 |
| Project1 タブ | メモ更新 | `PUT /api/projects/:id/notes` (案) | メモ専用エンドポイントを追加してもよい。 |
| Project2/3 タブ ★ | ライト状態保存 | `POST /api/light-states` | Unityから受け取ったパラメータを保存。 |
| Project2/3 タブ ★ | ライト状態取得 | `GET /api/light-states?sceneId=` | 過去状態を復元。 |
| Project3 タブ | ライトメタ情報取得 | `GET /api/lights/meta` (案) | ラベル・ツールチップ内容を提供。 |
| Project4 タブ ★ | シーン一覧取得 | `GET /api/scenes?projectId=` | カード表示、並べ替え。 |
| Project4 タブ ★ | シーン保存 | `POST /api/scenes` | ProjectIdとlightStateを受け取り保存。 |
| Project4 タブ | シーン更新 | `PUT /api/scenes/:id` | メモ修正、名称変更。 |
| Project4 タブ | シーンエクスポート | `POST /api/scenes/:id/export` | CSV/画像生成、ジョブキューにしても良い。 |
| Project5 タブ | 共有リンク取得 | `GET /api/projects/:id/share-link` | 既存リンク表示。 |
| Project5 タブ | メール招待 | `POST /api/projects/:id/share` | メールアドレス送信。 |
| Stage画面 | ステージプリセット一覧 | `GET /api/stages/presets` | Stage1〜4の名称/サムネのみ取得。照明情報は含めない。 |
| Stage画面 | ステージ選択状態保存 | `PUT /api/projects/:id/stage` | 選択したステージIDのみ保存。 |
| Comments タブ | コメント一覧 | `GET /api/projects/:id/comments` | ページング必須。 |
| Comments タブ | コメント投稿 | `POST /api/projects/:id/comments` | 成功後通知作成。 |
| 通知画面 | 通知一覧 | `GET /api/notifications` | 未読件数を他画面でも使う。 |
| 通知画面 | 既読更新 | `POST /api/notifications/read` | ID配列を受け取る。 |
| ライブラリ | アセット一覧 | `GET /api/assets` | カテゴリ/タグフィルタ。 |
| ライブラリ | アセット詳細 | `GET /api/assets/:id` | 詳細モーダルで使用。 |
| プロフィール | 自分のプロフィール取得 | `GET /api/users/me` | 初期値読込。 |
| プロフィール | プロフィール更新 | `PUT /api/users/me` | 表示名・通知設定更新。 |
| プロフィール | アバターアップロード | `POST /api/users/me/avatar` | 画像アップロードAPI。 |

## 優先API（Week0〜1で仕様確定）
1. 認証系: `POST /api/auth/login`, `POST /api/auth/register`, `POST /api/auth/refresh`
2. プロジェクト一覧: `GET /api/projects`, `POST /api/projects`
3. シーン保存＆ライト状態: `POST /api/scenes`, `POST /api/light-states`, `GET /api/scenes?projectId=`

## メモ
- `screen_usecase.md` にある優先度を参照しながら、未定義API（ライトメタ情報、共有リンクなど）はドラフト段階で「案」と明示した。
- DB担当（たべちゃん）と `light_states`, `scenes`, `stage_presets` テーブルの構造を合意した上で、リクエスト/レスポンスのJSON構造を決定する。
